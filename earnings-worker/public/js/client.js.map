{
  "version": 3,
  "sources": ["../../src/client/math.ts", "../../src/client/main.ts"],
  "sourcesContent": ["/**\r\n * Types for Stock Data used in calculations\r\n */\r\nexport interface StockData {\r\n    allocation: number; // 0-100\r\n    pe?: number | null;\r\n    ps?: number | null;\r\n    peg?: number | null;\r\n    changeYTD?: number | null;\r\n    change1Y?: number | null;\r\n    quote?: {\r\n        epsCurrentYear?: number;\r\n        epsNextYear?: number;\r\n    } | null;\r\n    growth?: number; // Calculated field\r\n}\r\n\r\nexport interface WeightedAverages {\r\n    avgPE: string;\r\n    avgPS: string;\r\n    avgGrowth: string;\r\n    avgPEG: string;\r\n    avgYTD: string;\r\n    avg1Y: string;\r\n}\r\n\r\n/**\r\n * Calculates weighted averages for a portfolio of stocks.\r\n * @param stocks List of stock data\r\n * @returns Formatted string values for averages\r\n */\r\nexport function calculateWeightedAverages(stocks: StockData[]): WeightedAverages {\r\n    let wTotalPE = 0, wTotalGrowth = 0, wTotalPS = 0, wTotalPEG = 0, wTotalYTD = 0, wTotal1Y = 0;\r\n    let totalAllocPE = 0, totalAllocGrowth = 0, totalAllocPS = 0, totalAllocPEG = 0, totalAllocYTD = 0, totalAlloc1Y = 0;\r\n\r\n    stocks.forEach(stock => {\r\n        const alloc = stock.allocation || 0;\r\n\r\n        // Calculate Growth (Mutation: adding growth property if missing, but we should probably avoid mutation in pure function)\r\n        // For this function, we assume input might need calculation or comes pre-calculated.\r\n        // Let's replicate the logic from renderTable\r\n        const epsC = stock.quote?.epsCurrentYear || 0;\r\n        const epsN = stock.quote?.epsNextYear || 0;\r\n        let growth = stock.growth || 0;\r\n\r\n        // If growth wasn't pre-calculated, calculate it here\r\n        if (stock.growth === undefined && epsC !== 0) {\r\n            growth = ((epsN - epsC) / Math.abs(epsC)) * 100;\r\n        }\r\n\r\n        if (stock.pe && alloc > 0) { wTotalPE += stock.pe * alloc; totalAllocPE += alloc; }\r\n        // Filter out extreme growth outliers for the average\r\n        if (Math.abs(growth) < 1000 && alloc > 0) { wTotalGrowth += growth * alloc; totalAllocGrowth += alloc; }\r\n        if (stock.ps && alloc > 0) { wTotalPS += stock.ps * alloc; totalAllocPS += alloc; }\r\n        if (stock.peg && alloc > 0) { wTotalPEG += stock.peg * alloc; totalAllocPEG += alloc; }\r\n        if (stock.changeYTD != null && alloc > 0) { wTotalYTD += stock.changeYTD * alloc; totalAllocYTD += alloc; }\r\n        if (stock.change1Y != null && alloc > 0) { wTotal1Y += stock.change1Y * alloc; totalAlloc1Y += alloc; }\r\n    });\r\n\r\n    return {\r\n        avgPS: totalAllocPS > 0 ? (wTotalPS / totalAllocPS).toFixed(2) : '-',\r\n        avgPE: totalAllocPE > 0 ? (wTotalPE / totalAllocPE).toFixed(2) : '-',\r\n        avgGrowth: totalAllocGrowth > 0 ? (wTotalGrowth / totalAllocGrowth).toFixed(1) + '%' : '-',\r\n        avgPEG: totalAllocPEG > 0 ? (wTotalPEG / totalAllocPEG).toFixed(2) : '-',\r\n        avgYTD: totalAllocYTD > 0 ? (wTotalYTD / totalAllocYTD).toFixed(1) + '%' : '-',\r\n        avg1Y: totalAlloc1Y > 0 ? (wTotal1Y / totalAlloc1Y).toFixed(1) + '%' : '-'\r\n    };\r\n}\r\n", "/// <reference lib=\"dom\" />\r\nimport { calculateWeightedAverages, StockData } from './math';\r\n\r\n// We need to declare the global functions we rely on, or attach them to window\r\ndeclare global {\r\n    interface Window {\r\n        dashboardData: any[]; // The data loaded by legacy scripts\r\n        renderTable: any; // Use legacy or replace?\r\n    }\r\n}\r\n\r\nconsole.log('Client Module Loaded (v2.0)');\r\n\r\n/**\r\n * Hook into the existing renderTable or provide a helper function\r\n * that the legacy script calls.\r\n * \r\n * Strategy: We expose a global function `updateFooterAverages(data)` \r\n * that the legacy `renderTable` calls at the end.\r\n */\r\n(window as any).updateFooterAverages = function (data: any[]) {\r\n    // Convert untyped data to StockData\r\n    const stocks: StockData[] = data.map(d => ({\r\n        allocation: parseFloat(d.allocation) || 0,\r\n        pe: parseFloat(d.pe),\r\n        ps: parseFloat(d.ps),\r\n        peg: parseFloat(d.peg),\r\n        changeYTD: parseFloat(d.changeYTD),\r\n        change1Y: parseFloat(d.change1Y),\r\n        quote: d.quote,\r\n        growth: d.growth // Legacy script calculates this mutation\r\n    }));\r\n\r\n    const avgs = calculateWeightedAverages(stocks);\r\n\r\n    const setText = (id: string, val: string) => {\r\n        const el = document.getElementById(id);\r\n        if (el) el.textContent = val;\r\n    };\r\n\r\n    setText('avgPS', avgs.avgPS);\r\n    setText('avgPE', avgs.avgPE);\r\n    setText('avgGrowth', avgs.avgGrowth);\r\n    setText('avgPEG', avgs.avgPEG);\r\n    setText('avgYTD', avgs.avgYTD);\r\n    setText('avg1Y', avgs.avg1Y);\r\n};\r\n"],
  "mappings": "mBA+BO,SAASA,EAA0BC,EAAuC,CAC7E,IAAIC,EAAW,EAAGC,EAAe,EAAGC,EAAW,EAAGC,EAAY,EAAGC,EAAY,EAAGC,EAAW,EACvFC,EAAe,EAAGC,EAAmB,EAAGC,EAAe,EAAGC,EAAgB,EAAGC,EAAgB,EAAGC,EAAe,EAEnH,OAAAZ,EAAO,QAAQa,GAAS,CACpB,IAAMC,EAAQD,EAAM,YAAc,EAK5BE,EAAOF,EAAM,OAAO,gBAAkB,EACtCG,EAAOH,EAAM,OAAO,aAAe,EACrCI,EAASJ,EAAM,QAAU,EAGzBA,EAAM,SAAW,QAAaE,IAAS,IACvCE,GAAWD,EAAOD,GAAQ,KAAK,IAAIA,CAAI,EAAK,KAG5CF,EAAM,IAAMC,EAAQ,IAAKb,GAAYY,EAAM,GAAKC,EAAOP,GAAgBO,GAEvE,KAAK,IAAIG,CAAM,EAAI,KAAQH,EAAQ,IAAKZ,GAAgBe,EAASH,EAAON,GAAoBM,GAC5FD,EAAM,IAAMC,EAAQ,IAAKX,GAAYU,EAAM,GAAKC,EAAOL,GAAgBK,GACvED,EAAM,KAAOC,EAAQ,IAAKV,GAAaS,EAAM,IAAMC,EAAOJ,GAAiBI,GAC3ED,EAAM,WAAa,MAAQC,EAAQ,IAAKT,GAAaQ,EAAM,UAAYC,EAAOH,GAAiBG,GAC/FD,EAAM,UAAY,MAAQC,EAAQ,IAAKR,GAAYO,EAAM,SAAWC,EAAOF,GAAgBE,EACnG,CAAC,EAEM,CACH,MAAOL,EAAe,GAAKN,EAAWM,GAAc,QAAQ,CAAC,EAAI,IACjE,MAAOF,EAAe,GAAKN,EAAWM,GAAc,QAAQ,CAAC,EAAI,IACjE,UAAWC,EAAmB,GAAKN,EAAeM,GAAkB,QAAQ,CAAC,EAAI,IAAM,IACvF,OAAQE,EAAgB,GAAKN,EAAYM,GAAe,QAAQ,CAAC,EAAI,IACrE,OAAQC,EAAgB,GAAKN,EAAYM,GAAe,QAAQ,CAAC,EAAI,IAAM,IAC3E,MAAOC,EAAe,GAAKN,EAAWM,GAAc,QAAQ,CAAC,EAAI,IAAM,GAC3E,CACJ,CCxDA,QAAQ,IAAI,6BAA6B,EASxC,OAAe,qBAAuB,SAAUM,EAAa,CAE1D,IAAMC,EAAsBD,EAAK,IAAIE,IAAM,CACvC,WAAY,WAAWA,EAAE,UAAU,GAAK,EACxC,GAAI,WAAWA,EAAE,EAAE,EACnB,GAAI,WAAWA,EAAE,EAAE,EACnB,IAAK,WAAWA,EAAE,GAAG,EACrB,UAAW,WAAWA,EAAE,SAAS,EACjC,SAAU,WAAWA,EAAE,QAAQ,EAC/B,MAAOA,EAAE,MACT,OAAQA,EAAE,MACd,EAAE,EAEIC,EAAOC,EAA0BH,CAAM,EAEvCI,EAAU,CAACC,EAAYC,IAAgB,CACzC,IAAMC,EAAK,SAAS,eAAeF,CAAE,EACjCE,IAAIA,EAAG,YAAcD,EAC7B,EAEAF,EAAQ,QAASF,EAAK,KAAK,EAC3BE,EAAQ,QAASF,EAAK,KAAK,EAC3BE,EAAQ,YAAaF,EAAK,SAAS,EACnCE,EAAQ,SAAUF,EAAK,MAAM,EAC7BE,EAAQ,SAAUF,EAAK,MAAM,EAC7BE,EAAQ,QAASF,EAAK,KAAK,CAC/B",
  "names": ["calculateWeightedAverages", "stocks", "wTotalPE", "wTotalGrowth", "wTotalPS", "wTotalPEG", "wTotalYTD", "wTotal1Y", "totalAllocPE", "totalAllocGrowth", "totalAllocPS", "totalAllocPEG", "totalAllocYTD", "totalAlloc1Y", "stock", "alloc", "epsC", "epsN", "growth", "data", "stocks", "d", "avgs", "calculateWeightedAverages", "setText", "id", "val", "el"]
}
